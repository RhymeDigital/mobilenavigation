var MobileNavigation=new Class({Implements:Options,intHeight:0,intWidth:0,blnMenuOpen:false,blnNeedResize:true,blnLandscape:false,objMobileStage:false,options:{elMobileNavigation:false,elMobileNavigationTop:false,elMobileNavigationInside:false,elPanelContainer:false,elHiddenPanelContainer:false,idMobileNavigation:"mobilenavigation",idMobileNavigationTop:"mobilenavigationtop",idMobileNavigationInside:"mobilenavigationinside",idPanelContainer:"panelcontainer",idHiddenPanelContainer:"hiddenpanelcontainer",panelSelector:".panel",panelHeaderSelector:".panelHeader",panelContentSelector:".panelContent",submenuButtonSelector:".submenuButton",backButtonSelector:".menuBack",navItemsSelector:".navItems",portraitClass:"portrait",landscapeClass:"landscape",dropTransition:"sine:in",dropDuration:"short",slideTransition:Fx.Transitions.Sine.easeOut,slideDuration:400,zIndex:9999,preventClickSelectors:"ul, li, a",preventTouchMove:false,portraitMaxHeight:285,landscapeMaxHeight:135},initialize:function(a){this.setOptions(a);if(this.setElements()){this.setOrientation();this.setInitialPanel();this.setClosedPosition();this.setEvents();this.setListeners();window.fireEvent("orientationchange")}window.fireEvent("mobileNavigationMenuLoaded",this)},setElements:function(){if(this.options.elMobileNavigation===false&&$(this.options.idMobileNavigation)){this.options.elMobileNavigation=$(this.options.idMobileNavigation);this.options.elMobileNavigation=this.options.elMobileNavigation.inject(document.getElement("body"),"top")}else{return false}if(this.options.elMobileNavigationTop===false&&$(this.options.idMobileNavigationTop)){this.options.elMobileNavigationTop=$(this.options.idMobileNavigationTop)}if(this.options.elMobileNavigationInside===false&&$(this.options.idMobileNavigationInside)){this.options.elMobileNavigationInside=$(this.options.idMobileNavigationInside)}if(this.options.elPanelContainer===false&&$(this.options.idPanelContainer)){this.options.elPanelContainer=$(this.options.idPanelContainer)}if(this.options.elHiddenPanelContainer===false&&$(this.options.idHiddenPanelContainer)){this.options.elHiddenPanelContainer=$(this.options.idHiddenPanelContainer)}return true},setInitialPanel:function(){if(this.options.elHiddenPanelContainer!==false){var a=this.options.elHiddenPanelContainer.getElements(this.options.panelSelector);if(a.length>0){a[0].inject(this.options.elPanelContainer,"top");this.objMobileStage=new MobileStage(this.options.elPanelContainer,this.options);this.setInsideHeight()}}},setClosedPosition:function(){this.objWindowSize=window.getSize();this.objTopSize=this.options.elMobileNavigationTop.getSize();this.objInsideSize=this.options.elMobileNavigationInside.getSize();this.intPadBottom=parseInt(this.options.elMobileNavigationInside.getStyle("padding-bottom"));this.intPadTop=parseInt(this.options.elMobileNavigationInside.getStyle("padding-top"));this.intNewLeft=parseInt(this.objInsideSize.x)/2-parseInt(this.objInsideSize.x)/2;this.intNewTop=-(this.intHeight+this.intPadTop+this.objTopSize.y);this.options.elMobileNavigation.setStyles({left:this.intNewLeft,top:this.intNewTop,"z-index":parseInt(this.options.zIndex)})},setOpenPosition:function(){this.options.elMobileNavigation.setStyle("top","0px")},setOrientation:function(){this.blnLandscape=window.orientation==0||window.orientation==180?false:true;var a=this.blnLandscape?this.options.landscapeClass:this.options.portraitClass;var b=this.blnLandscape?this.options.portraitClass:this.options.landscapeClass;if(document.body.hasClass(b)){document.body.removeClass(b)}document.body.addClass(a)},setEvents:function(){this.options.elMobileNavigation.addEvent("touchmove",function(a){a.preventDefault()});if(this.options.elMobileNavigationInside){this.options.elMobileNavigationInside.addEvent("touchmove",function(a){a.stopPropagation()})}if(this.options.preventTouchMove){document.addEvent("touchmove",function(a){a.preventDefault()})}this.options.elMobileNavigation.addEvent("mouseup",function(){this.setInsideHeight();if(this.options.elMobileNavigation.getPosition().y!=0){(function(){var a=new Fx.Tween(this.options.elMobileNavigation.get("id"),{duration:this.options.dropDuration,transition:this.options.dropTransition,link:"cancel",property:"top",onComplete:function(){this.blnMenuOpen=true}.bind(this)});a.start(-(this.intHeight+this.objTopSize.y),0)}).delay(50,this)}else{(function(){var a=new Fx.Tween(this.options.elMobileNavigation.get("id"),{duration:this.options.dropDuration,transition:this.options.dropTransition,link:"cancel",property:"top",onComplete:function(){this.blnMenuOpen=false}.bind(this)});a.start(0,-(this.intHeight+this.objTopSize.y))}).delay(50,this)}}.bind(this));var a=this.options.elMobileNavigation.getElements(this.options.preventClickSelectors);if(a.length>0){a.each(function(a,b){a.addEvent("mouseup",function(a){a.stopPropagation()})})}this.setSubmenuButtonEvents(this.options.elMobileNavigation);this.setBackButtonEvents(this.options.elHiddenPanelContainer)},setListeners:function(){window.addEventListener("orientationchange",function(){this.doResize()}.bind(this),false);window.addEventListener("resize",function(){if(this.blnNeedResize){this.doResize()}}.bind(this),false)},doResize:function(){this.setOrientation();this.setInsideHeight();if(this.blnMenuOpen)this.setOpenPosition();else this.setClosedPosition();if(this.objMobileStage){this.objMobileStage.setOrientation();this.objMobileStage.resizeStage();this.objMobileStage.resetLeftPosition()}this.blnNeedResize=false},setInsideHeight:function(){try{var a=this.options.elPanelContainer.getElements(this.options.panelContentSelector);if(a.length>0){var b=this.intHeight;var c=this.blnLandscape?this.options.landscapeMaxHeight:this.options.portraitMaxHeight;for(var d=0;d<a.length;d++){if(a[d].getSize().y>b){b=a[d].getSize().y}}this.intHeight=b>c?c:b;this.options.elMobileNavigationInside.setStyle("height",this.intHeight);this.options.elPanelContainer.setStyle("height",this.intHeight)}}catch(e){}},setSubmenuButtonEvents:function(a){var b=a.getElements(this.options.submenuButtonSelector);if(b.length>0){b.each(function(a){a.addEvent("click",function(a){var b=a.getProperty("class");var c=b.split(" ");var d=this.getSubmenuPanel(c[c.length-1]);this.objMobileStage.addPanel(d);this.objMobileStage.slidePanel({direction:"left"});return false}.bind(this,a))}.bind(this))}},setBackButtonEvents:function(a){var b=a.getElements(this.options.backButtonSelector);if(b.length>0){b.each(function(a){a.addEvent("click",function(a){this.objMobileStage.slidePanel({direction:"right"});(function(){var b=a.getParents(this.options.panelSelector)[0];this.objMobileStage.removePanel(b,this.options.elHiddenPanelContainer)}).delay(this.options.slideDuration,this,a);return false}.bind(this,a))}.bind(this))}},getSubmenuPanel:function(a){var b=this.options.elHiddenPanelContainer.getChildren("."+a);if(b.length){return b[0]}}});var MobileStage=new Class({Implements:Options,Binds:["toggleSlidingOn","toggleSlidingOff"],currentIndex:0,totalWidth:0,isSliding:0,blnLandscape:false,options:{panelSelector:".panel",slideTransition:"sine:in",slideDuration:"short"},initialize:function(a,b){this.setOptions(b);this.setOrientation();this.element=a;this.mobileNavInside=this.options.elMobileNavigationInside;this.currDim=this.element.getSize();this.panelWidth=this.currDim.x;if(this.blnLandscape)this.panelHeight=this.options.landscapeMaxHeight>this.mobileNavInside.getStyle("height").toInt()?this.mobileNavInside.getStyle("height").toInt():this.options.landscapeMaxHeight;else this.panelHeight=this.options.portraitMaxHeight>this.mobileNavInside.getStyle("height").toInt()?this.mobileNavInside.getStyle("height").toInt():this.options.portraitMaxHeight;var c=parseInt(this.mobileNavInside.getStyle("padding-top")+this.mobileNavInside.getStyle("padding-bottom"));this.panelHeight-=c;this.panels=this.element.getElements(this.options.panelSelector);this.totalWidth=this.panelWidth*this.panels.length+10*this.panels.length;this.element.setStyles({position:"absolute",width:this.totalWidth,height:this.panelHeight,left:0});this.panels.each(function(a,b){var c=parseInt(a.getStyle("padding-right"))+parseInt(a.getStyle("padding-left"));var d=parseInt(this.mobileNavInside.getStyle("padding-top")+this.mobileNavInside.getStyle("padding-bottom"));a.setStyles({width:this.panelWidth-c,height:this.panelHeight,"float":"left"})}.bind(this));this.element.set("morph",{link:"ignore",duration:this.options.slideDuration,transition:this.options.slideTransition,onStart:this.toggleSlidingOn,onComplete:this.toggleSlidingOff})},setOrientation:function(){this.blnLandscape=window.orientation==0||window.orientation==180?false:true},slidePanel:function(a,b){if(this.isSliding==0){if(!$defined(b))b=Function.from("return;");var c=parseInt(this.element.getStyle("left"));switch(a.direction){case"left":if(this.currentIndex==this.panels.length-1){this.slideToEnd("left")}else{var d=c-this.panelWidth;var e=new Fx.Morph(this.element,{duration:this.options.slideDuration,transition:this.slideTransition,onStart:this.toggleSlidingOn,onComplete:function(){this.toggleSlidingOff();b.bind(this)}.bind(this)});e.start({left:[c,d]});this.currentIndex++}break;default:if(this.currentIndex==0){this.slideToEnd("right")}else{var d=c+this.panelWidth;var e=new Fx.Morph(this.element,{duration:this.options.slideDuration,transition:this.slideTransition,onStart:this.toggleSlidingOn,onComplete:function(){this.toggleSlidingOff();b.bind(this)}.bind(this)});e.start({left:[c,d]});this.currentIndex--}}}},slideToEnd:function(a){var b=parseInt(this.element.getStyle("left"));var c=a=="left"?b-100:b+100;var d=new Fx.Morph(this.element,{link:"chain",duration:"short",transition:this.options.slideTransition,onStart:this.toggleSlidingOn,onChainComplete:this.toggleSlidingOff});d.start({left:[b,c]}).start({left:[c,b]})},toggleSlidingOn:function(){this.isSliding=1},toggleSlidingOff:function(){this.isSliding=0},addPanel:function(a){if(this.isSliding==1){this.addPanel(a)}if(!a.hasClass(this.options.panelSelector.replace(".",""))){a.addClass(this.options.panelSelector.replace(".",""))}a.inject(this.panels[this.panels.length-1],"after");this.resizeStage()},removePanel:function(a,b){if(b){a.inject(b)}else{a.dispose()}this.resizeStage()},resizeStage:function(){this.panels=this.element.getElements(this.options.panelSelector);this.panelWidth=this.mobileNavInside.getStyle("width").toInt();if(this.blnLandscape)this.panelHeight=this.options.landscapeMaxHeight>this.mobileNavInside.getStyle("height").toInt()?this.mobileNavInside.getStyle("height").toInt():this.options.landscapeMaxHeight;else this.panelHeight=this.options.portraitMaxHeight>this.mobileNavInside.getStyle("height").toInt()?this.mobileNavInside.getStyle("height").toInt():this.options.portraitMaxHeight;var a=parseInt(this.mobileNavInside.getStyle("padding-top")+this.mobileNavInside.getStyle("padding-bottom"));this.panelHeight-=a;this.panels.each(function(a,b){var c=parseInt(a.getStyle("padding-right"))+parseInt(a.getStyle("padding-left"));a.setStyles({width:this.panelWidth-c,height:this.panelHeight,"float":"left"})}.bind(this));this.totalWidth=this.panelWidth*this.panels.length+10*this.panels.length;this.element.setStyles({width:this.totalWidth,height:this.panelHeight})},resetLeftPosition:function(){var a=this.panelWidth*this.currentIndex*-1;this.element.setStyle("left",a.toString()+"px")}})